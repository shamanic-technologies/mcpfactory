name: E2E Tests

on:
  # Run manually or on schedule
  workflow_dispatch:
  schedule:
    # Run every 6 hours
    - cron: "0 */6 * * *"

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install dependencies
        working-directory: e2e-tests
        run: npm install

      - name: Run health checks
        working-directory: e2e-tests
        run: npm run test:health
        env:
          REPLY_QUALIFICATION_SERVICE_URL: https://reply-qualification.mcpfactory.org
          COMPANY_SERVICE_URL: https://company.mcpfactory.org
          POSTMARK_SERVICE_URL: https://postmark.mcpfactory.org

      - name: Run qualification tests
        working-directory: e2e-tests
        run: npm run test:qualification
        env:
          REPLY_QUALIFICATION_SERVICE_URL: https://reply-qualification.mcpfactory.org
          REPLY_QUALIFICATION_SERVICE_API_KEY: ${{ secrets.REPLY_QUALIFICATION_SERVICE_API_KEY }}
